{% extends "base.html" %}
{% block content %}
<!-- Add Javascript Script -->
<script src="../static/app.js"></script>

<!-- Chatbot Section -->
<div id="chatbot">
  <div id="chatbot-body">

    <!-- Chatbot GUI -->
    <div id="chatbot-body-input">
      <input
              type="text"
              id="question-input"
              placeholder="Type your question here..."
      >
      <button id="chatbot-body-input-button">
        Send
      </button>
      <div id="chatbot-filter">
        <input type="text" id="filter-input" placeholder="Search keywords...">
        <button id="filter-button">Filter</button>
      </div>
    </div>
    <div class="toggle-switch">
      <div class="toggle-switch-handle" title="https://www.iconhunt.site/">
      </div>
    </div>
  </div>

  <!-- Chatbot History Displays - Includes Sent and Received -->
  <div id="chatbot-response">
    <div id="response"></div>
  </div>
  <div id="chatbot-history">
    <button id="chatbot-history-button">Clear History</button>
    <div id="history">
      <ul id="history-list"></ul>
    </div>
  </div>

<!--  Typing Indicator -->
  <div class="chat-bubble">
    <div class="typing-indicator">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</div>

<!-- Search functionality:
Due to the way chat history is displayed in the DOM, this script has some repeated
code that could not be avoided. However the filter is fully functional, and since
it is only querying text should still be performant.-->
<script>
  // Filter chat history
  document.getElementById('filter-button').addEventListener('click', filterChatHistory);
  document.getElementById('filter-input').addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
      filterChatHistory();
    }
  });

  function filterChatHistory() {
    var filterInput = document.getElementById('filter-input');
    var filterValue = filterInput.value.toLowerCase();

    var historyList = document.getElementById('history-list');
    var responses = historyList.getElementsByClassName('response');
    var questions = historyList.getElementsByClassName('question');

    // FILTERING AI CHAT RESPONSES
    for (var i = 0; i < responses.length; i++) {
      var response = responses[i];
      var responseText = response.textContent.toLowerCase();
      var userContainer = response.previousElementSibling;

      if (responseText.includes(filterValue)) {
        response.style.display = 'block';
        if (userContainer) {
          userContainer.style.display = 'block';
        }
      } else {
        response.style.display = 'none';
        if (userContainer) {
          userContainer.style.display = 'none';
        }
      }
    }
    
// FILTERING QUESTIONS
    for (var j = 0; j < questions.length; j++) {
      var question = questions[j];
      var questionText = question.textContent.toLowerCase();
      var userContainer = question.previousElementSibling;

      if (questionText.includes(filterValue)) {
        question.style.display = 'block';
        if (userContainer) {
          userContainer.style.display = 'block';
        }
      } else {
        question.style.display = 'none';
        if (userContainer) {
          userContainer.style.display = 'none';
        }
      }
    }
  }
</script>

{% endblock %}